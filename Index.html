<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šåœ‹è²¨å¹£è‡ªç”±æ›ç®—</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
        }

        .converter-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }

        h2 { text-align: center; color: #333; margin: 0 0 1rem 0; }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            text-align: center;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            padding: 8px;
            border-radius: 5px;
            background-color: #eee;
            color: #666;
        }

        /* åŒ¯ç‡è¨­å®šå€ (æ‘ºç–Šå¼æˆ–ç¶²æ ¼) */
        .rate-settings {
            background-color: #fcfcfc;
            border: 1px solid #e0e0e0;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        .rate-settings h3 {
            margin: 0 0 8px 0;
            font-size: 0.9rem;
            color: #555;
            text-align: center;
            cursor: pointer;
        }
        
        /* ç¶²æ ¼ä½ˆå±€é¡¯ç¤ºæ‰€æœ‰åŒ¯ç‡ */
        .rates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* å…©æ¬„ */
            gap: 8px;
            font-size: 0.85rem;
        }

        .rate-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff;
            padding: 5px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .rate-item input {
            width: 70px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 2px;
            font-size: 0.85rem;
        }

        /* è¼¸å…¥åˆ—æ¨£å¼ */
        .row-container {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 5px 10px;
            transition: border-color 0.2s;
        }
        .row-container:focus-within {
            border-color: #4a90e2;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.2);
        }

        /* åœ‹æ——èˆ‡é¸å–®å€ */
        .selector-area {
            display: flex;
            align-items: center;
            min-width: 130px; /* ç¢ºä¿é¸å–®å¯¬åº¦å›ºå®š */
            border-right: 1px solid #eee;
            padding-right: 10px;
            margin-right: 10px;
        }

        .flag-icon {
            font-size: 1.5rem;
            margin-right: 8px;
        }

        select {
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            outline: none;
            width: 100%;
        }

        /* è¼¸å…¥æ¡† */
        input.amount-input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 1.4rem;
            text-align: right;
            color: #333;
            background: transparent;
        }

        /* æŒ‰éˆ• */
        .refresh-btn {
            display: block;
            margin: 15px auto 0 auto;
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 20px;
            cursor: pointer;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #555;
            transition: 0.2s;
        }
        .refresh-btn:hover { background: #eee; color: #000; }

        .hint { text-align: center; font-size: 0.75rem; color: #aaa; margin-top: 5px; }
    </style>
</head>
<body>

<div class="converter-card">
    <h2>ğŸ’± å…¨çƒè²¨å¹£è‡ªç”±æ›ç®—</h2>
    
    <div id="status" class="status-bar">é€£ç·šä¸­...</div>

    <div class="rate-settings">
        <h3>ğŸ“Š åŒ¯ç‡è¨­å®š (åŸºæº–: 1 USD)</h3>
        <div class="rates-grid" id="rates-container">
            </div>
        <div class="hint">è‹¥é€£ç·šå¤±æ•—ï¼Œå¯æ‰‹å‹•ä¿®æ”¹ä¸Šæ–¹æ•¸å­—</div>
    </div>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-1">ğŸ‡¹ğŸ‡¼</span>
            <select id="select-1" onchange="updateRow(1)">
                </select>
        </div>
        <input type="number" id="input-1" class="amount-input" placeholder="0" oninput="convert(1)">
    </div>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-2">ğŸ‡¯ğŸ‡µ</span>
            <select id="select-2" onchange="updateRow(2)">
                </select>
        </div>
        <input type="number" id="input-2" class="amount-input" placeholder="0" oninput="convert(2)">
    </div>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-3">ğŸ‡ºğŸ‡¸</span>
            <select id="select-3" onchange="updateRow(3)">
                </select>
        </div>
        <input type="number" id="input-3" class="amount-input" placeholder="0" oninput="convert(3)">
    </div>

    <button class="refresh-btn" onclick="fetchRates()">ğŸ”„ é‡æ–°æŠ“å–å³æ™‚åŒ¯ç‡</button>
</div>

<script>
    // --- è¨­å®šè³‡æ–™ ---
    // å®šç¾©æ‰€æœ‰æ”¯æ´çš„è²¨å¹£ã€åç¨±ã€åœ‹æ——ã€é è¨­åŒ¯ç‡
    const currencies = {
        TWD: { name: "æ–°å°å¹£", flag: "ğŸ‡¹ğŸ‡¼", rate: 32.5 },
        JPY: { name: "æ—¥åœ“", flag: "ğŸ‡¯ğŸ‡µ", rate: USD150.032m },
        : { name: "ç¾é‡‘", flag: "ğŸ‡ºğŸ‡¸", rate: 1.0 },
        KRW: { name: "éŸ“å…ƒ", flag: "ğŸ‡°ğŸ‡·", rate: 1450.0 },
        CNY: { name: "äººæ°‘å¹£", flag: "ğŸ‡¨ğŸ‡³", rate: EUR7.22m },
        : { name: "æ­å…ƒ", flag: "ğŸ‡ªğŸ‡º", rate: GBP0.920m },
        : { name: "è‹±éŠ", flag: "ğŸ‡¬ğŸ‡§", rate: 0.79 },
        IDR: { name: "å°å°¼ç›¾", flag: "ğŸ‡®ğŸ‡©", rate: 15600.0 }
    };

    // é è¨­çš„ä¸‰è¡Œé¸æ“‡ (å¯ä»¥è‡ªå·±æ”¹é€™è£¡)
    const defaultSelections = ['TWD', 'JPY', 'USD'];

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        initRateInputs(); // å»ºç«‹ä¸Šæ–¹åŒ¯ç‡è¨­å®šæ ¼
        initDropdowns();  // å»ºç«‹ä¸‹æ‹‰é¸å–®
        fetchRates();     // æŠ“å–ç¶²è·¯åŒ¯ç‡
    };

    // 1. å‹•æ…‹å»ºç«‹ã€ŒåŒ¯ç‡è¨­å®šã€å€å¡Š
    function initRateInputs() {
        const container = document.getElementById('rates-container');
        let html = '';
        for (let code in currencies) {
            html += `
                <div class="rate-item">
                    <span>${currencies[code].flag} ${code}</span>
                    <input type="number" id="rate-${code}" value="${currencies[code].rate}" oninput="updateRateValue('${code}')">
                </div>
            `;
        }
        container.innerHTML = html;
    }

    // 2. å‹•æ…‹å»ºç«‹ä¸‹æ‹‰é¸å–®é¸é …
    function initDropdowns() {
        // ç‚º 1, 2, 3 è¡Œåˆ†åˆ¥å¡«å…¥é¸é …
        [1, 2, 3].forEach((rowId, index) => {
            const selectEl = document.getElementById(`select-${rowId}`);
            let options = '';
            for (let code in currencies) {
                // åˆ¤æ–·æ˜¯å¦ç‚ºé è¨­å€¼
                const selected = (code === defaultSelections[index]) ? 'selected' : '';
                options += `<option value="${code}" ${selected}>${code} ${currencies[code].name}</option>`;
            }
            selectEl.innerHTML = options;
            // åˆå§‹åŒ–åœ‹æ——
            updateRow(rowId, false); // false ä»£è¡¨ä¸è¦è§¸ç™¼è¨ˆç®—
        });
    }

    // 3. å¾ç¶²è·¯æŠ“å–åŒ¯ç‡
    function fetchRates() {
        const statusDiv = document.getElementById('status');
        statusDiv.innerHTML = "â³ é€£ç·šæ›´æ–°åŒ¯ç‡ä¸­...";
        statusDiv.style.background = "#eef";
        statusDiv.style.color = "#666";

        fetch('https://api.exchangerate-api.com/v4/latest/USD')
            .then(response => response.json())
            .then(data => {
                // æ›´æ–°è³‡æ–™åº«
                for (let code in currencies) {
                    if (data.rates[code]) {
                        currencies[code].rate = data.rates[code];
                        // æ›´æ–°ç•«é¢ä¸Šçš„è¨­å®šæ ¼
                        const inputEl = document.getElementById(`rate-${code}`);
                        if (inputEl) inputEl.value = currencies[code].rate;
                    }
                }
                
                statusDiv.innerHTML = `âœ… åŒ¯ç‡å·²æ›´æ–° (${data.date})`;
                statusDiv.style.background = "#e8f5e9";
                statusDiv.style.color = "#2e7d32";

                // è‹¥ç¬¬ä¸€è¡Œæœ‰æ•¸å­—ï¼Œå‰‡é‡æ–°è¨ˆç®—
                if(document.getElementById('input-1').value) {
                    convert(1);
                }
            })
            .catch(err => {
                console.error(err);
                statusDiv.innerHTML = `âš ï¸ é€£ç·šå¤±æ•—ï¼Œä½¿ç”¨æ‰‹å‹•/é è¨­åŒ¯ç‡`;
                statusDiv.style.background = "#ffebee";
                statusDiv.style.color = "#c62828";
            });
    }

    // 4. ç•¶ä½¿ç”¨è€…æ‰‹å‹•ä¿®æ”¹åŒ¯ç‡è¨­å®šæ ¼
    function updateRateValue(code) {
        const inputEl = document.getElementById(`rate-${code}`);
        currencies[code].rate = parseFloat(inputEl.value) || 0;
        
        // ä¿®æ”¹åŒ¯ç‡å¾Œï¼Œä»¥ç›®å‰æœ€å¾Œæ“ä½œçš„é‚£ä¸€è¡Œ(å‡è¨­æ˜¯ç¬¬ä¸€è¡Œ)ä¾†é‡ç®—
        if(document.getElementById('input-1').value) convert(1);
    }

    // 5. ç•¶ä¸‹æ‹‰é¸å–®æ”¹è®Šæ™‚ (æ›´æ–°åœ‹æ——)
    function updateRow(rowId, triggerConvert = true) {
        const selectEl = document.getElementById(`select-${rowId}`);
        const flagEl = document.getElementById(`flag-${rowId}`);
        const selectedCode = selectEl.value;

        // æ›´æ–°åœ‹æ——
        flagEl.textContent = currencies[selectedCode].flag;

        // åˆ‡æ›å¹£åˆ¥å¾Œï¼Œä¿ç•™è©²æ ¼æ•¸å­—ï¼Œé‡æ–°è¨ˆç®—å…¶ä»–æ ¼
        if (triggerConvert && document.getElementById(`input-${rowId}`).value) {
            convert(rowId);
        }
    }

    // 6. æ ¸å¿ƒæ›ç®—é‚è¼¯
    function convert(sourceRowId) {
        // å–å¾—è¼¸å…¥çš„é‚£ä¸€è¡Œçš„å¹£åˆ¥èˆ‡é‡‘é¡
        const sourceSelect = document.getElementById(`select-${sourceRowId}`);
        const sourceInput = document.getElementById(`input-${sourceRowId}`);
        
        const sourceCode = sourceSelect.value;
        const sourceAmount = parseFloat(sourceInput.value);

        // å¦‚æœè¼¸å…¥ç„¡æ•ˆæˆ–æ¸…ç©ºï¼Œå‰‡æ¸…ç©ºæ‰€æœ‰æ¬„ä½
        if (isNaN(sourceAmount)) {
            [1, 2, 3].forEach(id => {
                if(id !== sourceRowId) document.getElementById(`input-${id}`).value = '';
            });
            return;
        }

        // æ­¥é©Ÿ A: å…ˆæ›ç®—æˆç¾é‡‘ (åŸºæº–)
        // å…¬å¼: ç•¶åœ°è²¨å¹£ / åŒ¯ç‡ = ç¾é‡‘
        const amountInUSD = sourceAmount / currencies[sourceCode].rate;

        // æ­¥é©Ÿ B: å°‡ç¾é‡‘æ›ç®—æˆå…¶ä»–è¡Œ
        [1, 2, 3].forEach(targetRowId => {
            if (targetRowId !== sourceRowId) {
                const targetCode = document.getElementById(`select-${targetRowId}`).value;
                const targetRate = currencies[targetCode].rate;
                
                // å…¬å¼: ç¾é‡‘ * åŒ¯ç‡ = ç•¶åœ°è²¨å¹£
                const result = amountInUSD * targetRate;
                
                // é¡¯ç¤ºçµæœ (ç¾é‡‘é€šå¸¸ä¿ç•™2ä½ï¼Œæ—¥éŸ“å°å°¼ç›¾ç­‰å¹£å€¼å°çš„å¯ä¸ä¿ç•™å°æ•¸ï¼Œé€™è£¡çµ±ä¸€ä¿ç•™2ä½è¼ƒæ•´é½Š)
                document.getElementById(`input-${targetRowId}`).value = result.toFixed(2);
            }
        });
    }
</script>

</body>
</html>
