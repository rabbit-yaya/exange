<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²¨å¹£æ›ç®—å™¨ (æœ¬æ©Ÿæ‡‰ç”¨ç¨‹å¼ç‰ˆ)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f3f3f3;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* é˜²æ­¢å‡ºç¾å·è»¸ */
            user-select: none; /* åƒæ‡‰ç”¨ç¨‹å¼ä¸€æ¨£ï¼Œé˜²æ­¢æ–‡å­—è¢«éš¨æ„é¸å– */
        }

        .converter-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            width: 90%;
            max-width: 480px;
        }

        h2 { 
            text-align: center; 
            color: #333; 
            margin: 0 0 1.5rem 0; 
            font-size: 1.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .status-bar {
            text-align: center;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
            padding: 8px;
            border-radius: 6px;
            background-color: #f0f0f0;
            color: #666;
            font-weight: 500;
        }

        /* åŒ¯ç‡è¨­å®šå€ (é è¨­æ‘ºç–Šï¼Œé»æ“Šå±•é–‹) */
        .rate-settings {
            background-color: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .rate-settings summary {
            padding: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            color: #555;
            text-align: center;
            list-style: none;
            font-weight: bold;
        }
        
        .rate-settings summary:hover { background: #f0f0f0; }

        .rates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .rate-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .rate-item span { font-size: 1.2rem; margin-right: 5px; }
        .rate-item input {
            width: 70px;
            text-align: center;
            border: none;
            outline: none;
            font-weight: bold;
            color: #444;
            background: transparent;
        }

        /* è¼¸å…¥åˆ— */
        .row-container {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 8px 12px;
            transition: border-color 0.2s;
        }
        .row-container:focus-within {
            border-color: #0078d4; /* Windows è— */
        }

        .selector-area {
            display: flex;
            align-items: center;
            min-width: 120px;
            border-right: 1px solid #eee;
            padding-right: 10px;
            margin-right: 10px;
        }

        .flag-icon { font-size: 1.6rem; margin-right: 8px; }

        select {
            border: none;
            background: transparent;
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            outline: none;
            width: 100%;
        }

        input.amount-input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 1.6rem;
            text-align: right;
            font-family: Consolas, monospace; /* æ•¸å­—ç­‰å¯¬å­—é«” */
            color: #333;
            background: transparent;
        }

        .action-btn {
            width: 100%;
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #555;
            transition: 0.2s;
            margin-top: 10px;
        }
        .action-btn:hover { background: #e2e6ea; color: #000; }

    </style>
</head>
<body>

<div class="converter-card">
    <h2>ğŸ’± åŒ¯ç‡æ›ç®—å™¨</h2>
    
    <div id="status" class="status-bar">æº–å‚™å°±ç·’</div>

    <details class="rate-settings" id="details-panel">
        <summary>âš™ï¸ åŒ¯ç‡è¨­å®š (é»æ“Šå±•é–‹)</summary>
        <div class="rates-grid" id="rates-container"></div>
        <div style="text-align: center; font-size: 0.75rem; color: #999; padding-bottom: 5px;">
            åŸºæº–: 1 ç¾é‡‘ (USD)
        </div>
    </details>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-1">ğŸ‡¹ğŸ‡¼</span>
            <select id="select-1" onchange="updateRow(1)"></select>
        </div>
        <input type="number" id="input-1" class="amount-input" placeholder="0" oninput="convert(1)">
    </div>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-2">ğŸ‡¯ğŸ‡µ</span>
            <select id="select-2" onchange="updateRow(2)"></select>
        </div>
        <input type="number" id="input-2" class="amount-input" placeholder="0" oninput="convert(2)">
    </div>

    <div class="row-container">
        <div class="selector-area">
            <span class="flag-icon" id="flag-3">ğŸ‡ºğŸ‡¸</span>
            <select id="select-3" onchange="updateRow(3)"></select>
        </div>
        <input type="number" id="input-3" class="amount-input" placeholder="0" oninput="convert(3)">
    </div>

    <button class="action-btn" onclick="tryFetchRates()">ğŸ”„ æ›´æ–°åŒ¯ç‡</button>
</div>

<script>
    // 1. ä¿®æ­£å¾Œçš„è³‡æ–™çµæ§‹ (ä½ åŸæœ¬çš„ä»£ç¢¼æœ‰èªæ³•éŒ¯èª¤ï¼Œé€™è£¡å·²ä¿®å¾©)
    const currencies = {
        TWD: { name: "æ–°å°å¹£", flag: "ğŸ‡¹ğŸ‡¼", rate: 32.5 },
        JPY: { name: "æ—¥åœ“", flag: "ğŸ‡¯ğŸ‡µ", rate: 152.0 }, // ä¿®æ­£éŒ¯èª¤
        USD: { name: "ç¾é‡‘", flag: "ğŸ‡ºğŸ‡¸", rate: 1.0 },   // ä¿®æ­£éŒ¯èª¤
        KRW: { name: "éŸ“å…ƒ", flag: "ğŸ‡°ğŸ‡·", rate: 1450.0 },
        CNY: { name: "äººæ°‘å¹£", flag: "ğŸ‡¨ğŸ‡³", rate: 7.25 },  // ä¿®æ­£éŒ¯èª¤
        EUR: { name: "æ­å…ƒ", flag: "ğŸ‡ªğŸ‡º", rate: 0.92 },  // ä¿®æ­£éŒ¯èª¤
        GBP: { name: "è‹±éŠ", flag: "ğŸ‡¬ğŸ‡§", rate: 0.79 },  // ä¿®æ­£éŒ¯èª¤
        IDR: { name: "å°å°¼ç›¾", flag: "ğŸ‡®ğŸ‡©", rate: 15600.0 }
    };

    const defaultSelections = ['TWD', 'JPY', 'USD'];

    window.onload = function() {
        initUI();
        // æœ¬æ©ŸåŸ·è¡Œæ™‚ï¼Œé è¨­å…ˆä¸é€£ç¶²ï¼Œé¿å…è½‰åœˆåœˆï¼Œç›´æ¥ä½¿ç”¨å…§å»ºå€¼
        document.getElementById('status').innerText = "âš¡ å·²è¼‰å…¥ (é›¢ç·šæ¨¡å¼)";
        // å˜—è©¦å·å·åœ¨èƒŒæ™¯æ›´æ–°
        tryFetchRates(true);
    };

    function initUI() {
        // å»ºç«‹åŒ¯ç‡è¨­å®šæ ¼
        const container = document.getElementById('rates-container');
        let html = '';
        for (let code in currencies) {
            html += `
                <div class="rate-item">
                    <span>${currencies[code].flag}</span>
                    <input type="number" id="rate-${code}" value="${currencies[code].rate}" onchange="updateRateValue('${code}')">
                </div>
            `;
        }
        container.innerHTML = html;

        // å»ºç«‹ä¸‹æ‹‰é¸å–®
        [1, 2, 3].forEach((rowId, index) => {
            const selectEl = document.getElementById(`select-${rowId}`);
            let options = '';
            for (let code in currencies) {
                const selected = (code === defaultSelections[index]) ? 'selected' : '';
                options += `<option value="${code}" ${selected}>${code}</option>`;
            }
            selectEl.innerHTML = options;
            updateRow(rowId, false);
        });
    }

    // å˜—è©¦æŠ“å–åŒ¯ç‡ (æ”¯æ´æœ¬æ©Ÿæª”æ¡ˆ)
    async function tryFetchRates(silent = false) {
        const statusDiv = document.getElementById('status');
        if(!silent) {
            statusDiv.innerHTML = "â³ é€£ç·šä¸­...";
            statusDiv.style.background = "#fff3cd";
        }

        // ä½¿ç”¨æ”¯æ´ CORS çš„é–‹æº CDNï¼Œé€™åœ¨æœ¬æ©Ÿæª”æ¡ˆä¹Ÿèƒ½é‹ä½œ
        const apiUrl = 'https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json';

        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("Network Error");
            const data = await response.json();
            const rates = data.usd;

            // æ›´æ–°åŒ¯ç‡
            for (let code in currencies) {
                let key = code.toLowerCase();
                if (rates[key]) {
                    currencies[code].rate = rates[key];
                    let input = document.getElementById(`rate-${code}`);
                    if(input) input.value = rates[key];
                }
            }
            
            statusDiv.innerHTML = `âœ… åŒ¯ç‡æ›´æ–°æˆåŠŸ (${data.date})`;
            statusDiv.style.background = "#d4edda";
            statusDiv.style.color = "#155724";
            
            // é‡æ–°è¨ˆç®—
            if(document.getElementById('input-1').value) convert(1);

        } catch (e) {
            console.log("Offline mode");
            if(!silent) {
                statusDiv.innerHTML = "âš ï¸ ç„¡æ³•é€£ç·šï¼Œä½¿ç”¨æ‰‹å‹•/é è¨­åŒ¯ç‡";
                statusDiv.style.background = "#f8d7da";
                statusDiv.style.color = "#721c24";
            }
        }
    }

    function updateRateValue(code) {
        const inputEl = document.getElementById(`rate-${code}`);
        currencies[code].rate = parseFloat(inputEl.value) || 0;
        if(document.getElementById('input-1').value) convert(1);
    }

    function updateRow(rowId, triggerConvert = true) {
        const selectEl = document.getElementById(`select-${rowId}`);
        const flagEl = document.getElementById(`flag-${rowId}`);
        const code = selectEl.value;
        flagEl.textContent = currencies[code].flag;
        if (triggerConvert && document.getElementById(`input-${rowId}`).value) convert(rowId);
    }

    function convert(sourceRowId) {
        const sourceCode = document.getElementById(`select-${sourceRowId}`).value;
        const sourceVal = parseFloat(document.getElementById(`input-${sourceRowId}`).value);

        if (isNaN(sourceVal)) {
            [1, 2, 3].forEach(id => {
                if(id !== sourceRowId) document.getElementById(`input-${id}`).value = '';
            });
            return;
        }

        // è½‰æ›é‚è¼¯
        const usdVal = sourceVal / currencies[sourceCode].rate;

        [1, 2, 3].forEach(targetRowId => {
            if (targetRowId !== sourceRowId) {
                const targetCode = document.getElementById(`select-${targetRowId}`).value;
                const result = usdVal * currencies[targetCode].rate;
                
                // é‡å°å¹£å€¼å°çš„è²¨å¹£ä¸é¡¯ç¤ºå°æ•¸é»ï¼Œè®“ç•«é¢æ›´ä¹¾æ·¨
                const noDecimals = ['JPY', 'KRW', 'IDR', 'VND'];
                if (noDecimals.includes(targetCode)) {
                    document.getElementById(`input-${targetRowId}`).value = Math.round(result);
                } else {
                    document.getElementById(`input-${targetRowId}`).value = result.toFixed(2);
                }
            }
        });
    }
</script>

</body>
</html>
