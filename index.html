<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››åœ‹è²¨å¹£åŒ¯ç‡æ›ç®— (TWD/JPY/USD/KRW)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .converter-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }

        h2 { text-align: center; color: #333; margin-bottom: 0.5rem; margin-top: 0; }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            text-align: center;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            padding: 8px;
            border-radius: 5px;
            background-color: #eee;
            color: #666;
        }

        /* åŒ¯ç‡è¨­å®šå€å¡Š */
        .rate-settings {
            background-color: #f8f9fa;
            border: 1px dashed #ccc;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }
        .rate-settings h3 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: #555;
            text-align: center;
        }
        .rate-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .rate-row span:first-child { min-width: 60px; } /* å°é½Šç”¨ */
        .rate-row input {
            width: 80px;
            padding: 3px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            color: #444;
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .input-group { margin-bottom: 1.2rem; }
        .input-group label {
            display: block;
            margin-bottom: 0.4rem;
            color: #555;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .input-wrapper {
            display: flex;
            align-items: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 5px 10px;
            transition: border-color 0.3s;
            background: #fff;
        }
        .input-wrapper:focus-within { border-color: #4a90e2; }
        
        .flag { font-size: 1.5rem; margin-right: 10px; }
        .currency-code { font-weight: bold; color: #333; margin-right: 10px; min-width: 40px; }
        
        /* ä¸»è¦è¼¸å…¥æ•¸å­—å€ */
        .main-input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 1.3rem;
            text-align: right;
            color: #333;
        }

        /* æŒ‰éˆ• */
        .refresh-btn {
            display: block;
            margin: 0 auto;
            background: none;
            border: 1px solid #ccc;
            padding: 5px 15px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #666;
            transition: 0.2s;
        }
        .refresh-btn:hover { background: #eee; color: #333; }

    </style>
</head>
<body>

<div class="converter-card">
    <h2>ğŸ’± åŒ¯ç‡æ›ç®—å™¨</h2>
    
    <div id="status" class="status-bar">æº–å‚™é€£ç·š...</div>

    <div class="rate-settings">
        <h3>ğŸ“Š åŒ¯ç‡è¨­å®š (åŸºæº–: 1 ç¾é‡‘)</h3>
        <div class="rate-row">
            <span>1 USD = </span>
            <input type="number" id="rate-twd" value="32.5" oninput="updateRate('TWD')">
            <span>TWD (å°å¹£)</span>
        </div>
        <div class="rate-row">
            <span>1 USD = </span>
            <input type="number" id="rate-jpy" value="150.0" oninput="updateRate('JPY')">
            <span>JPY (æ—¥å¹£)</span>
        </div>
        <div class="rate-row">
            <span>1 USD = </span>
            <input type="number" id="rate-krw" value="1450.0" oninput="updateRate('KRW')">
            <span>KRW (éŸ“å…ƒ)</span>
        </div>
        <div style="text-align: center; margin-top:8px; font-size: 0.75rem; color: #888;">
            (è‹¥é€£ç·šå¤±æ•—ï¼Œå¯ç›´æ¥ä¿®æ”¹ä¸Šæ–¹æ•¸å­—)
        </div>
    </div>

    <div class="input-group">
        <label>æ–°å°å¹£ (TWD)</label>
        <div class="input-wrapper">
            <span class="flag">ğŸ‡¹ğŸ‡¼</span>
            <span class="currency-code">TWD</span>
            <input type="number" id="twd" class="main-input" placeholder="0" oninput="convert('twd')">
        </div>
    </div>

    <div class="input-group">
        <label>æ—¥åœ“ (JPY)</label>
        <div class="input-wrapper">
            <span class="flag">ğŸ‡¯ğŸ‡µ</span>
            <span class="currency-code">JPY</span>
            <input type="number" id="jpy" class="main-input" placeholder="0" oninput="convert('jpy')">
        </div>
    </div>

    <div class="input-group">
        <label>éŸ“å…ƒ (KRW)</label>
        <div class="input-wrapper">
            <span class="flag">ğŸ‡°ğŸ‡·</span>
            <span class="currency-code">KRW</span>
            <input type="number" id="krw" class="main-input" placeholder="0" oninput="convert('krw')">
        </div>
    </div>

    <div class="input-group">
        <label>ç¾é‡‘ (USD)</label>
        <div class="input-wrapper">
            <span class="flag">ğŸ‡ºğŸ‡¸</span>
            <span class="currency-code">USD</span>
            <input type="number" id="usd" class="main-input" placeholder="0" oninput="convert('usd')">
        </div>
    </div>

    <button class="refresh-btn" onclick="fetchRates()">ğŸ”„ é‡æ–°æŠ“å–å³æ™‚åŒ¯ç‡</button>
</div>

<script>
    // é è¨­åŒ¯ç‡ (ç•¶æ²’ç¶²è·¯æ™‚çš„å‚™ç”¨å€¼)
    let rates = {
        USD10m: ,
        TWD32.57m: , 
        JPY: 150.0,
        KRW: 1450.0 // æ–°å¢éŸ“å…ƒé è¨­å€¼
    };

    const statusDiv = document.getElementById('status');
    const rateInputTwd = document.getElementById('rate-twd');
    const rateInputJpy = document.getElementById('rate-jpy');
    const rateInputKrw = document.getElementById('rate-krw');

    // 1. ç¶²é é–‹å•Ÿæ™‚å˜—è©¦æŠ“å–
    window.onload = function() {
        fetchRates();
    };

    // 2. æŠ“å–åŒ¯ç‡ API
    function fetchRates() {
        statusDiv.innerHTML = "â³ æ­£åœ¨é€£ç·šå–å¾—æœ€æ–°åŒ¯ç‡...";
        statusDiv.style.background = "#eef";
        statusDiv.style.color = "#666";

        const apiUrl = 'https://api.exchangerate-api.com/v4/latest/USD';

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) throw new Error("Network response was not ok");
                return response.json();
            })
            .then(data => {
                // æ›´æ–°å…§éƒ¨è®Šæ•¸
                rates.TWD = data.rates.TWD;
                rates.JPY = data.rates.JPY;
                rates.KRW = data.rates.KRW; // æŠ“å–éŸ“å…ƒ

                // æ›´æ–°ç•«é¢ä¸Šçš„ã€ŒåŒ¯ç‡è¨­å®šã€æ¡†æ¡†
                rateInputTwd.value = rates.TWD.toFixed(2);
                rateInputJpy.value = rates.JPY.toFixed(2);
                rateInputKrw.value = rates.KRW.toFixed(2);

                // æ›´æ–°ç‹€æ…‹åˆ—
                const date = new Date(data.date);
                statusDiv.innerHTML = `âœ… åŒ¯ç‡æ›´æ–°æˆåŠŸ (${data.date})`;
                statusDiv.style.background = "#e8f5e9";
                statusDiv.style.color = "#2e7d32";
                
                // è§¸ç™¼é‡æ–°è¨ˆç®— (å¦‚æœç¾é‡‘æ¬„ä½æœ‰å€¼)
                if(document.getElementById('usd').value !== "") {
                    convert('usd');
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                statusDiv.innerHTML = `âš ï¸ ç„¡æ³•é€£ç·šï¼Œè«‹æ‰‹å‹•è¼¸å…¥ä¸Šæ–¹åŒ¯ç‡`;
                statusDiv.style.background = "#ffebee";
                statusDiv.style.color = "#c62828";
            });
    }

    // 3. æ‰‹å‹•ä¿®æ”¹åŒ¯ç‡
    function updateRate(currency) {
        if(currency === 'TWD') rates.TWD = parseFloat(rateInputTwd.value);
        if(currency === 'JPY') rates.JPY = parseFloat(rateInputJpy.value);
        if(currency === 'KRW') rates.KRW = parseFloat(rateInputKrw.value);

        // ä¿®æ”¹å¾Œç«‹å³ä»¥ç¾é‡‘æ¬„ä½ç‚ºåŸºæº–é‡ç®—
        const currentUsd = document.getElementById('usd').value;
        if(currentUsd) convert('usd');
    }

    // 4. æ ¸å¿ƒæ›ç®—é‚è¼¯
    function convert(source) {
        const twdInput = document.getElementById('twd');
        const jpyInput = document.getElementById('jpy');
        const krwInput = document.getElementById('krw');
        const usdInput = document.getElementById('usd');

        let value = 0;
        let amountInUSD = 0;

        // ç¢ºä¿ä½¿ç”¨æœ€æ–°çš„è¨­å®šåŒ¯ç‡
        rates.TWD = parseFloat(rateInputTwd.value) || 32.5;
        rates.JPY = parseFloat(rateInputJpy.value) || 150.0;
        rates.KRW = parseFloat(rateInputKrw.value) || 1450.0;

        // å–å¾—è¼¸å…¥å€¼
        if (source === 'twd') {
            value = parseFloat(twdInput.value);
            amountInUSD = value / rates.TWD;
        } else if (source === 'jpy') {
            value = parseFloat(jpyInput.value);
            amountInUSD = value / rates.JPY;
        } else if (source === 'krw') {
            value = parseFloat(krwInput.value);
            amountInUSD = value / rates.KRW;
        } else if (source === 'usd') {
            value = parseFloat(usdInput.value);
            amountInUSD = value;
        }

        // è™•ç†ç©ºå€¼
        if (isNaN(value)) {
            if (source !== 'twd') twdInput.value = '';
            if (source !== 'jpy') jpyInput.value = '';
            if (source !== 'krw') krwInput.value = '';
            if (source !== 'usd') usdInput.value = '';
            return;
        }

        // è¨ˆç®—ä¸¦å¡«å…¥å…¶ä»–æ¬„ä½ (ä¿ç•™ 2 ä½å°æ•¸)
        if (source !== 'twd') twdInput.value = (amountInUSD * rates.TWD).toFixed(2);
        if (source !== 'jpy') jpyInput.value = (amountInUSD * rates.JPY).toFixed(2);
        if (source !== 'krw') krwInput.value = (amountInUSD * rates.KRW).toFixed(2);
        if (source !== 'usd') usdInput.value = (amountInUSD * rates.USD).toFixed(2);
    }
</script>

</body>
</html>
